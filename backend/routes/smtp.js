const express = require("express"); const router = express.Router(); const { saveSmtpConfig, getSmtpConfig } = require("../database/db"); router.post("/", async (req, res) => { try { const { host, port, user, pass, secure } = req.body; if (!host || !port || !user || !pass) { return res.status(400).json({ error: "Missing required SMTP configuration fields" }); } const config = { host, port: parseInt(port), user, pass, secure: Boolean(secure) }; const result = await saveSmtpConfig(config); res.json({ success: true, message: "SMTP configuration saved successfully", config: result }); } catch (error) { console.error("Error saving SMTP config:", error); res.status(500).json({ error: "Failed to save SMTP configuration" }); } }); router.get("/", async (req, res) => { try { const config = await getSmtpConfig(); if (!config) { return res.json({ success: false, message: "No SMTP configuration found" }); } const { pass, ...safeConfig } = config; res.json({ success: true, config: safeConfig }); } catch (error) { console.error("Error getting SMTP config:", error); res.status(500).json({ error: "Failed to get SMTP configuration" }); } }); module.exports = router;
